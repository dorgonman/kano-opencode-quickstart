<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OpenCode localStorage åŒæ­¥å·¥å…·</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .container {
      background: white;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      max-width: 800px;
      width: 100%;
      padding: 40px;
    }
    
    h1 {
      color: #333;
      margin-bottom: 10px;
      font-size: 28px;
    }
    
    .subtitle {
      color: #666;
      margin-bottom: 30px;
      font-size: 14px;
    }
    
    .warning {
      background: #fff3cd;
      border-left: 4px solid #ffc107;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 4px;
    }
    
    .warning strong {
      color: #856404;
    }
    
    .section {
      margin-bottom: 30px;
    }
    
    .section h2 {
      color: #667eea;
      font-size: 18px;
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .section h2::before {
      content: '';
      width: 4px;
      height: 20px;
      background: #667eea;
      border-radius: 2px;
    }
    
    button {
      background: #667eea;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
      width: 100%;
      margin-bottom: 10px;
    }
    
    button:hover {
      background: #5568d3;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }
    
    button:active {
      transform: translateY(0);
    }
    
    button.secondary {
      background: #6c757d;
    }
    
    button.secondary:hover {
      background: #5a6268;
    }
    
    button.success {
      background: #28a745;
    }
    
    button.success:hover {
      background: #218838;
    }
    
    textarea {
      width: 100%;
      min-height: 150px;
      padding: 12px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      resize: vertical;
      margin-bottom: 10px;
    }
    
    textarea:focus {
      outline: none;
      border-color: #667eea;
    }
    
    .stats {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
    }
    
    .stats p {
      margin: 5px 0;
      color: #495057;
      font-size: 14px;
    }
    
    .stats strong {
      color: #667eea;
    }
    
    .info {
      background: #d1ecf1;
      border-left: 4px solid #17a2b8;
      padding: 15px;
      margin-top: 20px;
      border-radius: 4px;
      font-size: 14px;
      color: #0c5460;
    }
    
    .success-message {
      background: #d4edda;
      border-left: 4px solid #28a745;
      padding: 15px;
      margin-top: 15px;
      border-radius: 4px;
      color: #155724;
      display: none;
    }
    
    .error-message {
      background: #f8d7da;
      border-left: 4px solid #dc3545;
      padding: 15px;
      margin-top: 15px;
      border-radius: 4px;
      color: #721c24;
      display: none;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ”„ OpenCode localStorage åŒæ­¥å·¥å…·</h1>
    <p class="subtitle">è§£æ±º localhost å’Œ Tailscale ç¶²å€è³‡æ–™ä¸åŒæ­¥çš„å•é¡Œ</p>
    
    <div class="warning">
      <strong>âš ï¸ é‡è¦èªªæ˜ï¼š</strong>
      <p>ç€è¦½å™¨çš„ localStorage æ˜¯æŒ‰ç…§<strong>ç¶²åŸŸï¼ˆdomainï¼‰</strong>éš”é›¢çš„ã€‚</p>
      <p>â€¢ <code>localhost:4096</code> å’Œ <code>your-machine.tailscale.net:4096</code> æ˜¯ä¸åŒçš„ç¶²åŸŸ</p>
      <p>â€¢ æ‰€ä»¥å®ƒå€‘çš„ localStorage è³‡æ–™æ˜¯å®Œå…¨ç¨ç«‹çš„</p>
      <p>â€¢ é€™å€‹å·¥å…·å¯ä»¥å¹«ä½ åœ¨ä¸åŒç¶²åŸŸä¹‹é–“è¤‡è£½è³‡æ–™</p>
    </div>

    <!-- åŒ¯å‡ºå€åŸŸ -->
    <div class="section">
      <h2>1ï¸âƒ£ åŒ¯å‡ºè³‡æ–™ï¼ˆå¾ä¾†æºç¶²åŸŸï¼‰</h2>
      <p style="margin-bottom: 15px; color: #666;">
        åœ¨ä½ æƒ³è¦<strong>è¤‡è£½è³‡æ–™çš„ä¾†æºç¶²åŸŸ</strong>ï¼ˆä¾‹å¦‚ localhostï¼‰é–‹å•Ÿé€™å€‹é é¢ï¼Œé»æ“Šä¸‹æ–¹æŒ‰éˆ•ï¼š
      </p>
      <button onclick="exportData()">ğŸ“¤ åŒ¯å‡º OpenCode è³‡æ–™</button>
      <textarea id="exportArea" placeholder="åŒ¯å‡ºçš„è³‡æ–™æœƒé¡¯ç¤ºåœ¨é€™è£¡..." readonly></textarea>
      <button class="secondary" onclick="copyExport()">ğŸ“‹ è¤‡è£½åˆ°å‰ªè²¼ç°¿</button>
      <div id="exportStats" class="stats" style="display: none;"></div>
    </div>

    <!-- åŒ¯å…¥å€åŸŸ -->
    <div class="section">
      <h2>2ï¸âƒ£ åŒ¯å…¥è³‡æ–™ï¼ˆåˆ°ç›®æ¨™ç¶²åŸŸï¼‰</h2>
      <p style="margin-bottom: 15px; color: #666;">
        åœ¨ä½ æƒ³è¦<strong>è²¼ä¸Šè³‡æ–™çš„ç›®æ¨™ç¶²åŸŸ</strong>ï¼ˆä¾‹å¦‚ Tailscaleï¼‰é–‹å•Ÿé€™å€‹é é¢ï¼Œè²¼ä¸Šè³‡æ–™ï¼š
      </p>
      <textarea id="importArea" placeholder="è²¼ä¸ŠåŒ¯å‡ºçš„ JSON è³‡æ–™..."></textarea>
      <button class="success" onclick="importData()">ğŸ“¥ åŒ¯å…¥è³‡æ–™</button>
      <div id="importStats" class="stats" style="display: none;"></div>
    </div>

    <div class="success-message" id="successMessage"></div>
    <div class="error-message" id="errorMessage"></div>

    <div class="info">
      <strong>ğŸ’¡ ä½¿ç”¨æ­¥é©Ÿï¼š</strong>
      <ol style="margin-left: 20px; margin-top: 10px;">
        <li>åœ¨ <code>localhost:4096</code> é–‹å•Ÿé€™å€‹ HTML æª”æ¡ˆ</li>
        <li>é»æ“Šã€ŒåŒ¯å‡º OpenCode è³‡æ–™ã€ä¸¦è¤‡è£½</li>
        <li>åœ¨ <code>your-machine.tailscale.net:4096</code> é–‹å•Ÿé€™å€‹ HTML æª”æ¡ˆ</li>
        <li>è²¼ä¸Šè³‡æ–™ä¸¦é»æ“Šã€ŒåŒ¯å…¥è³‡æ–™ã€</li>
        <li>é‡æ–°æ•´ç†é é¢ï¼Œè³‡æ–™å°±åŒæ­¥äº†ï¼</li>
      </ol>
    </div>
  </div>

  <script>
    function exportData() {
      try {
        const backup = {};
        let count = 0;
        let totalSize = 0;

        for (let i = 0; i < localStorage.length; i++) {
          const key = localStorage.key(i);
          if (key && key.startsWith('opencode.')) {
            const value = localStorage.getItem(key);
            if (value) {
              backup[key] = value;
              count++;
              totalSize += value.length;
            }
          }
        }

        const json = JSON.stringify(backup, null, 2);
        document.getElementById('exportArea').value = json;
        
        const stats = document.getElementById('exportStats');
        stats.innerHTML = `
          <p><strong>åŒ¯å‡ºæˆåŠŸï¼</strong></p>
          <p>â€¢ é …ç›®æ•¸é‡ï¼š${count}</p>
          <p>â€¢ è³‡æ–™å¤§å°ï¼š${(totalSize / 1024).toFixed(2)} KB</p>
          <p>â€¢ ç•¶å‰ç¶²åŸŸï¼š${window.location.hostname}</p>
        `;
        stats.style.display = 'block';

        showSuccess(`âœ… æˆåŠŸåŒ¯å‡º ${count} å€‹é …ç›®ï¼`);
      } catch (error) {
        showError('åŒ¯å‡ºå¤±æ•—ï¼š' + error.message);
      }
    }

    function copyExport() {
      const textarea = document.getElementById('exportArea');
      if (!textarea.value) {
        showError('è«‹å…ˆåŒ¯å‡ºè³‡æ–™ï¼');
        return;
      }

      textarea.select();
      document.execCommand('copy');
      showSuccess('âœ… å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼');
    }

    function importData() {
      try {
        const textarea = document.getElementById('importArea');
        const json = textarea.value.trim();
        
        if (!json) {
          showError('è«‹è²¼ä¸ŠåŒ¯å‡ºçš„è³‡æ–™ï¼');
          return;
        }

        const backup = JSON.parse(json);
        let imported = 0;
        let failed = 0;

        Object.entries(backup).forEach(([key, value]) => {
          try {
            localStorage.setItem(key, value);
            imported++;
          } catch (e) {
            console.error('Failed to set', key, e);
            failed++;
          }
        });

        const stats = document.getElementById('importStats');
        stats.innerHTML = `
          <p><strong>åŒ¯å…¥å®Œæˆï¼</strong></p>
          <p>â€¢ æˆåŠŸåŒ¯å…¥ï¼š${imported} å€‹é …ç›®</p>
          ${failed > 0 ? `<p style="color: #dc3545;">â€¢ å¤±æ•—ï¼š${failed} å€‹é …ç›®</p>` : ''}
          <p>â€¢ ç›®æ¨™ç¶²åŸŸï¼š${window.location.hostname}</p>
        `;
        stats.style.display = 'block';

        showSuccess(`âœ… æˆåŠŸåŒ¯å…¥ ${imported} å€‹é …ç›®ï¼è«‹é‡æ–°æ•´ç†é é¢ã€‚`);
        
        // 3 ç§’å¾Œè‡ªå‹•é‡æ–°æ•´ç†
        setTimeout(() => {
          if (confirm('è³‡æ–™å·²åŒ¯å…¥ï¼æ˜¯å¦è¦é‡æ–°æ•´ç†é é¢ï¼Ÿ')) {
            location.reload();
          }
        }, 2000);
      } catch (error) {
        showError('åŒ¯å…¥å¤±æ•—ï¼š' + error.message);
      }
    }

    function showSuccess(message) {
      const el = document.getElementById('successMessage');
      el.textContent = message;
      el.style.display = 'block';
      setTimeout(() => el.style.display = 'none', 5000);
    }

    function showError(message) {
      const el = document.getElementById('errorMessage');
      el.textContent = message;
      el.style.display = 'block';
      setTimeout(() => el.style.display = 'none', 5000);
    }
  </script>
</body>
</html>
